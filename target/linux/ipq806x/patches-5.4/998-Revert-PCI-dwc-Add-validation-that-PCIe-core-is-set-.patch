From abb3587a296fdd239fb727d068d84ea2e95c8d8d Mon Sep 17 00:00:00 2001
From: Robert Marko <robert.marko@sartura.hr>
Date: Mon, 4 May 2020 19:42:28 +0200
Subject: [PATCH] Revert "PCI: dwc: Add validation that PCIe core is set to
 correct mode"

This reverts commit 0b24134f7888175c9638e6fd1900e23e44fc172f.
---
 drivers/pci/controller/dwc/pcie-designware-ep.c  |  8 --------
 .../pci/controller/dwc/pcie-designware-host.c    | 16 ----------------
 2 files changed, 24 deletions(-)

--- a/drivers/pci/controller/dwc/pcie-designware-ep.c
+++ b/drivers/pci/controller/dwc/pcie-designware-ep.c
@@ -498,7 +498,6 @@ int dw_pcie_ep_init(struct dw_pcie_ep *e
 	int ret;
 	u32 reg;
 	void *addr;
-	u8 hdr_type;
 	unsigned int nbars;
 	unsigned int offset;
 	struct pci_epc *epc;
@@ -563,13 +562,6 @@ int dw_pcie_ep_init(struct dw_pcie_ep *e
 	if (ep->ops->ep_init)
 		ep->ops->ep_init(ep);
 
-	hdr_type = dw_pcie_readb_dbi(pci, PCI_HEADER_TYPE);
-	if (hdr_type != PCI_HEADER_TYPE_NORMAL) {
-		dev_err(pci->dev, "PCIe controller is not set to EP mode (hdr_type:0x%x)!\n",
-			hdr_type);
-		return -EIO;
-	}
-
 	ret = of_property_read_u8(np, "max-functions", &epc->max_functions);
 	if (ret < 0)
 		epc->max_functions = 1;
--- a/drivers/pci/controller/dwc/pcie-designware-host.c
+++ b/drivers/pci/controller/dwc/pcie-designware-host.c
@@ -324,7 +324,6 @@ int dw_pcie_host_init(struct pcie_port *
 	struct pci_bus *child;
 	struct pci_host_bridge *bridge;
 	struct resource *cfg_res;
-	u32 hdr_type;
 	int ret;
 
 	raw_spin_lock_init(&pci->pp.lock);
@@ -466,21 +465,6 @@ int dw_pcie_host_init(struct pcie_port *
 			goto err_free_msi;
 	}
 
-	ret = dw_pcie_rd_own_conf(pp, PCI_HEADER_TYPE, 1, &hdr_type);
-	if (ret != PCIBIOS_SUCCESSFUL) {
-		dev_err(pci->dev, "Failed reading PCI_HEADER_TYPE cfg space reg (ret: 0x%x)\n",
-			ret);
-		ret = pcibios_err_to_errno(ret);
-		goto err_free_msi;
-	}
-	if (hdr_type != PCI_HEADER_TYPE_BRIDGE) {
-		dev_err(pci->dev,
-			"PCIe controller is not set to bridge type (hdr_type: 0x%x)!\n",
-			hdr_type);
-		ret = -EIO;
-		goto err_free_msi;
-	}
-
 	pp->root_bus_nr = pp->busn->start;
 
 	bridge->dev.parent = dev;
